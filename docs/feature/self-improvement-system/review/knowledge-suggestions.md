# Knowledge Evolution Suggestions

> **WARNING:** These are proposals only. Do NOT apply without human review.
> Generated by R-Knowledge agent during pipeline execution.

## Suggestions

### 1. [instruction-update] Create Cross-Cutting Concern Pattern Instruction

- **Target file:** `.github/instructions/cross-cutting-concerns.instructions.md`
- **Change type:** Add (new file)
- **Rationale:** The evaluation feature demonstrated a scalable pattern for adding cross-cutting capabilities to 14 agents with zero inconsistencies. No instruction exists to guide future features that need to add capabilities across multiple agents. Without documentation, future implementers would need to reverse-engineer the pattern from this feature's implementation.
- **Diff:**
  ```diff
  + # Cross-Cutting Concern Pattern
  +
  + When adding a capability that must be applied consistently across multiple agents:
  +
  + ## Step 1: Create a Shared Reference Document
  + - Place in `.github/agents/` alongside agent definitions
  + - Include: full schema/format definition, field-level constraints, error fallback format
  + - Include: behavioral rules (non-blocking, secondary to primary output)
  + - Include: collision avoidance rules, version identifier
  + - Name: `<feature-name>.md` (not `.agent.md` — this is a reference doc, not an agent)
  +
  + ## Step 2: Add Per-Agent Workflow Step
  + - Use a consistent template across all affected agents
  + - Agent-specific values: file paths, evaluation targets
  + - Place after primary work, before self-verification/memory writing
  + - Mark output as "secondary, non-blocking" in Outputs section
  + - Add shared reference document to Inputs section
  +
  + ## Step 3: Group Agents into Implementation Tasks
  + - Maximum 3 files per implementation task
  + - Group by pipeline phase (sequential agents, CT cluster, V cluster, R cluster)
  + - All tasks depend on the shared reference document task
  +
  + ## Precedent
  + - evaluation-schema.md + 14 evaluating agents (self-improvement-system feature)
  + - dispatch-patterns.md (existing reference document pattern)
  ```
- **Risk assessment:** Low — purely additive documentation; no behavior change

### 2. [instruction-update] Create Non-Blocking Agent Pattern Instruction

- **Target file:** `.github/instructions/non-blocking-agent.instructions.md`
- **Change type:** Add (new file)
- **Rationale:** Two non-blocking agents now exist (R-Knowledge, PostMortem). The pattern has clear requirements that are easy to miss without documentation: two-state contract, explicit ERROR-doesn't-block clause, orchestrator skip-merge behavior. Future additive agents would benefit from a checklist.
- **Diff:**
  ```diff
  + # Non-Blocking Agent Pattern
  +
  + Use this pattern for agents whose failure should NOT block the pipeline.
  +
  + ## Required Elements
  + 1. **Two-state completion contract:** DONE / ERROR only (no NEEDS_REVISION)
  + 2. **Description field:** Must mention "non-blocking"
  + 3. **Anti-Drift Anchor:** Must state "your ERROR does not block the pipeline"
  + 4. **File Boundaries section:** Explicit list of writable files
  + 5. **Read-Only Enforcement section:** If agent reads but doesn't modify codebase
  +
  + ## Orchestrator Integration
  + - Orchestrator Step N: "Non-blocking: <Agent> ERROR does NOT change the pipeline outcome"
  + - Orchestrator Expectations table: ERROR column = "Non-blocking; orchestrator proceeds without"
  + - Memory merge: "If <Agent> returned ERROR, log warning and skip merge"
  + - Completion Contract: Explicit statement that pipeline outcome is determined before this step
  +
  + ## Existing Non-Blocking Agents
  + - R-Knowledge (Step 7, R cluster member)
  + - PostMortem (Step 8, standalone)
  ```
- **Risk assessment:** Low — purely additive documentation

### 3. [instruction-update] Create Agent Definition Format Instruction

- **Target file:** `.github/instructions/agent-definition-format.instructions.md`
- **Change type:** Add (new file)
- **Rationale:** The `post-mortem.agent.md` code-fence format issue (V-Build warning) demonstrates that implementers can deviate from the implicit format convention. An explicit instruction prevents this class of error.
- **Diff:**
  ````diff
  + # Agent Definition File Format
  +
  + All agent definitions in `.github/agents/` MUST follow this format:
  +
  + ## File Naming
  + - Pattern: `<name>.agent.md`
  + - Names: lowercase, hyphen-separated (e.g., `post-mortem`, `ct-security`)
  + - Non-agent reference documents: `<name>.md` (no `.agent.` suffix)
  +
  + ## YAML Frontmatter
  + - MUST start with bare `---` at line 1 (NEVER wrapped in code fences)
  + - Required fields: `name` (lowercase, matches filename), `description` (quoted string)
  + - Example:
  +   ```
  +   ---
  +   name: post-mortem
  +   description: "Post-mortem analysis agent..."
  +   ---
  +   ```
  +
  + ## Required Sections (in order)
  + 1. Title & Role Description (`# <Name> Agent Workflow`)
  + 2. Inputs
  + 3. Outputs (including isolated memory file)
  + 4. Operating Rules (6 standard rules)
  + 5. Workflow (numbered steps)
  + 6. Completion Contract (DONE/ERROR or DONE/NEEDS_REVISION/ERROR)
  + 7. Anti-Drift Anchor (final section, reinforces role constraints)
  ````
- **Risk assessment:** Low — documents existing convention; no behavior change

### 4. [skill-update] Implementer: Add Format-Consistency Check for New Agent Files

- **Target file:** `.github/agents/implementer.agent.md`
- **Change type:** Update (add check to Self-Reflection step)
- **Rationale:** Task 02 introduced a format inconsistency (code-fence wrapper) that persisted through the entire pipeline. Adding a format check to the implementer's self-reflection prevents this class of error at the source.
- **Diff:**
  ```diff
    7. **Self-Reflection**
    - All task requirements addressed
    - Tests cover all acceptance criteria
    - No omissions
    - Code follows project conventions
  + - For new `.agent.md` files: verify frontmatter format matches existing agents in `.github/agents/` (bare `---` at line 1, not code-fenced)
    - "Would a senior engineer approve this code?"
  ```
- **Risk assessment:** Low — adds a consistency check without changing behavior

### 5. [skill-update] V-Build: Promote Frontmatter Format to Structural Check

- **Target file:** `.github/agents/v-build.agent.md`
- **Change type:** Update (add explicit structural validation)
- **Rationale:** V-Build detected the format issue but only as a warning. Since frontmatter format affects chatagent parser compatibility, this should be a structured check in the verification pass.
- **Diff:**
  ```diff
    ## Structural Content Checks
    ...
  + | All `.agent.md` files start with bare `---` frontmatter (not code-fenced) | ✅/❌ |
  ```
- **Risk assessment:** Low — adds validation rigor without false positives (only 1 known violation which should be fixed)

### 6. [pattern-capture] Shared Reference Document Pattern

- **Target file:** N/A (knowledge capture)
- **Change type:** N/A
- **Rationale:** Record the shared reference document pattern for future features. The evaluation-schema.md approach (single source of truth referenced by 14 agents) demonstrated zero inconsistencies across the entire pipeline, compared to the alternative of inlining the schema in each agent file.
- **Diff:** N/A — pattern documentation, not a code change. See [r-knowledge.md §Pattern Captures](r-knowledge.md) for full description.
- **Risk assessment:** N/A

### 7. [pattern-capture] Telemetry-in-Context Accumulation Pattern

- **Target file:** N/A (knowledge capture)
- **Change type:** N/A
- **Rationale:** Record the in-context telemetry accumulation pattern that resolved 3 CT findings. This pattern is applicable to any pipeline-wide metadata that must be collected incrementally and consumed once at the end.
- **Diff:** N/A — see [r-knowledge.md §Pattern Captures](r-knowledge.md) for full description.
- **Risk assessment:** N/A

### 8. [workflow-improvement] Add Automated Structural Linting to V-Build

- **Target file:** `.github/agents/v-build.agent.md`
- **Change type:** Update (add instruction for automated frontmatter/format checks)
- **Rationale:** The `post-mortem.agent.md` format issue persisted because V-Build relies on manual grep/read verification. A simple automated check (read first 5 lines of each `.agent.md`, verify `---` at line 1) would catch format deviations during the build step instead of as late-stage warnings. This is particularly valuable as the agent count grows.
- **Diff:**
  ```diff
    ## Workflow
    ...
    3. For each `.agent.md` file:
  +    a. Verify line 1 is exactly `---` (bare YAML frontmatter delimiter)
  +    b. Verify `name:` and `description:` fields exist between first and second `---`
  +    c. Flag any file that does not match as a structural error
       ...
  ```
- **Risk assessment:** Low — adds automated validation without changing existing behavior

### 9. [workflow-improvement] Add Spec-Design Reconciliation After CT Revisions

- **Target file:** `.github/agents/orchestrator.agent.md` (Step 3b handling)
- **Change type:** Update (add reconciliation routing)
- **Rationale:** When the CT cluster causes design revisions that deviate from the spec (as happened with AC-5/tool restriction), the spec remains stale. V-Feature then must adjudicate between spec and design, creating ambiguity. A reconciliation step where the designer or spec agent updates the spec after CT-approved revisions would close this gap.
- **Diff:**
  ```diff
    ### 3b. CT Decision Handling
    ...
    - **NEEDS_REVISION:** Route CT findings to designer for revision.
  + - After designer revision completes: if the revision deviates from feature.md
  +   acceptance criteria, consider routing to spec agent for a lightweight
  +   reconciliation pass to update affected ACs. (Optional — human judgment
  +   on whether the deviation is significant enough to warrant spec update.)
  ```
- **Risk assessment:** Medium — adds an optional pipeline step; needs careful scoping to avoid unnecessary spec agent re-execution for minor design adjustments

## Rejected Suggestions

<!-- No suggestions were rejected by KE-SAFE-6 during this analysis. All identified suggestions are additive — none remove or weaken safety constraints, error handling, or verification steps. -->

None.
